{"version":3,"sources":["cache.js","event-emitter.js","player.js"],"sourcesContent":["define(\"webaudio-player/cache\", [\"exports\"], function (exports) {\n  // k = key, v = value, e = (cache) entry\n  \"use strict\";\n\n  var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\n  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n  var Cache = (function () {\n    function Cache() {\n      var size = arguments.length <= 0 || arguments[0] === undefined ? 5 : arguments[0];\n\n      _classCallCheck(this, Cache);\n\n      this.cache = [];\n      this.size = size;\n    }\n\n    _createClass(Cache, [{\n      key: \"get\",\n      value: function get(k) {\n        var v = undefined;\n\n        this.cache.forEach(function (e) {\n          if (e.k === k) {\n            v = e.v;\n          }\n        });\n\n        return v;\n      }\n    }, {\n      key: \"set\",\n      value: function set(k, v) {\n        this.cache.push({\n          k: k,\n          v: v\n        });\n\n        if (this.cache.length > this.size) {\n          this.cache.shift();\n        }\n      }\n    }]);\n\n    return Cache;\n  })();\n\n  exports[\"default\"] = Cache;\n});","define(\"webaudio-player/event-emitter\", [\"exports\"], function (exports) {\n  \"use strict\";\n\n  var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\n  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n  var EventEmitter = (function () {\n    function EventEmitter() {\n      _classCallCheck(this, EventEmitter);\n\n      this._handlers = {};\n    }\n\n    _createClass(EventEmitter, [{\n      key: \"on\",\n      value: function on(name, fn) {\n        this._handlers[name] = this._handlers[name] || [];\n        this._handlers[name].push(fn);\n      }\n    }, {\n      key: \"trigger\",\n      value: function trigger(name) {\n        this._handlers[name] = this._handlers[name] || [];\n        this._handlers[name].forEach(function (fn) {\n          return fn();\n        });\n      }\n    }]);\n\n    return EventEmitter;\n  })();\n\n  exports[\"default\"] = EventEmitter;\n});","define('webaudio-player/player', ['exports', './cache', './event-emitter'], function (exports, _cache, _eventEmitter) {\n  'use strict';\n\n  var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\n  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\n  var Player = (function () {\n    function Player() {\n      _classCallCheck(this, Player);\n\n      this._context = new AudioContext();\n      this._destination = this._context.createGain();\n      this._destination.gain.value = 1;\n      this._destination.connect(this._context.destination);\n      this._cache = new _cache['default']();\n      this._promises = new _cache['default']();\n      this._emitter = new _eventEmitter['default']();\n    }\n\n    _createClass(Player, [{\n      key: 'getCacheDebugInformation',\n      value: function getCacheDebugInformation() {\n        return this._cache.cache;\n      }\n    }, {\n      key: 'play',\n      value: function play(url) {\n        var _this = this;\n\n        if (this._context.state === 'suspended') {\n          this._context.resume();\n        }\n\n        if (this._url === url) {\n          this.seekToPercent(0);\n          this._source.mediaElement.play();\n          return;\n        }\n\n        this._unload();\n        this._url = url;\n\n        this.preload(url).then(function (source) {\n          if (_this._url !== url) {\n            return;\n          }\n\n          _this._source = source;\n          _this._source.connect(_this._destination);\n\n          _this._source.mediaElement.addEventListener('ended', function () {\n            _this._emitter.trigger('ended');\n          });\n\n          _this.play(url);\n        });\n      }\n    }, {\n      key: 'preload',\n      value: function preload(url) {\n        var _this2 = this;\n\n        var source = this._cache.get(url);\n\n        if (source) {\n          return Promise.resolve(source);\n        }\n\n        var promise = this._promises.get(url);\n\n        if (promise) {\n          return promise;\n        }\n\n        var audio = new Audio();\n        audio.src = url;\n\n        promise = new Promise(function (resolve) {\n          var canplaythrough = function canplaythrough() {\n            audio.removeEventListener('canplaythrough', canplaythrough);\n            source = _this2._context.createMediaElementSource(audio);\n            _this2._cache.set(url, source);\n            resolve(source);\n          };\n\n          audio.addEventListener('canplaythrough', canplaythrough);\n          audio.load();\n        });\n\n        this._promises.set(url, promise);\n        return promise;\n      }\n    }, {\n      key: 'stop',\n      value: function stop() {\n        this._source.mediaElement.pause();\n      }\n    }, {\n      key: 'pause',\n      value: function pause() {\n        if (this.isPaused()) {\n          return;\n        }\n        this._isPaused = true;\n        this._context.suspend();\n      }\n    }, {\n      key: 'unpause',\n      value: function unpause() {\n        if (!this.isPaused()) {\n          return;\n        }\n        this._isPaused = false;\n        this._context.resume();\n      }\n    }, {\n      key: 'isPaused',\n      value: function isPaused() {\n        return this._isPaused;\n      }\n    }, {\n      key: 'setVolume',\n      value: function setVolume(volume) {\n        this._destination.gain.value = volume;\n      }\n    }, {\n      key: 'getVolume',\n      value: function getVolume(volume) {\n        return this._destination.gain.value;\n      }\n    }, {\n      key: 'mute',\n      value: function mute() {\n        this._oldVolume = this.getVolume();\n        this.setVolume(0);\n      }\n    }, {\n      key: 'unmute',\n      value: function unmute() {\n        this.setVolume(this._oldVolume || 1);\n        this.oldVolume = null;\n      }\n    }, {\n      key: '_unload',\n      value: function _unload() {\n        if (this._source) {\n          this.stop();\n          this._url = null;\n          this._source = null;\n        }\n      }\n    }, {\n      key: 'getSeconds',\n      value: function getSeconds() {\n        return this._source && this._source.mediaElement.currentTime || 0;\n      }\n    }, {\n      key: 'getDuration',\n      value: function getDuration() {\n        return this._source && this._source.mediaElement.duration || 0;\n      }\n    }, {\n      key: 'seekToPercent',\n      value: function seekToPercent(percent) {\n        this._source.mediaElement.currentTime = percent * this.getDuration();\n      }\n    }, {\n      key: 'on',\n      value: function on() {\n        var _emitter;\n\n        (_emitter = this._emitter).on.apply(_emitter, arguments);\n      }\n    }]);\n\n    return Player;\n  })();\n\n  exports['default'] = Player;\n});"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;","file":"webaudio-player.js"}